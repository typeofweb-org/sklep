# Migration `20200903152838-add-product`

This migration has been generated by Michal Miszczyszyn at 9/3/2020, 5:28:38 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "UserRole" AS ENUM ('USER', 'ADMIN')

CREATE TYPE "ProductType" AS ENUM ('SINGLE', 'BUNDLE')

ALTER TABLE "public"."Session" ADD COLUMN "createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
ADD COLUMN "updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP

ALTER TABLE "public"."User" ADD COLUMN "createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
ADD COLUMN "updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
DROP COLUMN "role",
ADD COLUMN "role" "UserRole"  NOT NULL DEFAULT E'USER'

DROP TYPE "Role"

CREATE TABLE "public"."Product" (
"id" SERIAL,
"name" text   NOT NULL ,
"slug" text   NOT NULL ,
"description" text   NOT NULL ,
"isPublic" boolean   NOT NULL DEFAULT false,
"regularPrice" integer   NOT NULL ,
"discountPrice" integer   ,
"type" "ProductType"  NOT NULL DEFAULT E'SINGLE',
"userId" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Product.name_unique" ON "public"."Product"("name")

CREATE UNIQUE INDEX "Product.slug_unique" ON "public"."Product"("slug")

ALTER TABLE "public"."Product" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200901123234-sessions..20200903152838-add-product
--- datamodel.dml
+++ datamodel.dml
@@ -3,27 +3,58 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
-  id       Int     @default(autoincrement()) @id
-  name     String?
-  email    String  @unique
+  id Int @default(autoincrement()) @id
+  name String?
+  email String @unique
   password String
-  role     Role    @default(USER)
+  
+  role UserRole @default(USER)
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now()) @updatedAt
 }
 model Session {
-  id         String   @id
+  id String @id
   validUntil DateTime
-  userId     Int
-  user       User     @relation(fields: [userId], references: [id])
+  userId Int
+  user User @relation(fields: [userId], references: [id])
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now()) @updatedAt
 }
-enum Role {
+enum UserRole {
   USER
   ADMIN
 }
+
+model Product {
+  id Int @default(autoincrement()) @id
+  name String @unique
+  slug String @unique
+  description String
+  isPublic Boolean @default(false)
+  
+  regularPrice Int
+  discountPrice Int?
+
+  type ProductType @default(SINGLE)
+
+  userId Int
+  addedBy User @relation(fields: [userId], references: [id])
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now()) @updatedAt
+}
+
+enum ProductType {
+  SINGLE
+  BUNDLE // @todo
+}
```


