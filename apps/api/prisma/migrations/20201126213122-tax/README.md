# Migration `20201126213122-tax`

This migration has been generated by kosmalaa at 11/26/2020, 10:31:22 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Product" ADD COLUMN "taxId" integer   

CREATE TABLE "public"."Tax" (
"id" SERIAL,
"name" text   NOT NULL ,
"taxRate" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Tax.name_unique" ON "public"."Tax"("name")

ALTER TABLE "public"."Product" ADD FOREIGN KEY("taxId")REFERENCES "public"."Tax"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201101150422-sklep..20201126213122-tax
--- datamodel.dml
+++ datamodel.dml
@@ -4,17 +4,17 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
   id Int @default(autoincrement()) @id
   name String?
   email String @unique
   password String
-  
+
   role UserRole @default(USER)
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now()) @updatedAt
@@ -41,9 +41,9 @@
   name String @unique
   slug String @unique
   description String
   isPublic Boolean @default(false)
-  
+
   regularPrice Int
   discountPrice Int?
   type ProductType @default(SINGLE)
@@ -52,8 +52,10 @@
   addedBy User @relation(fields: [userId], references: [id])
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now()) @updatedAt
+  taxId Int?
+  tax Tax? @relation(name: "ProductTax", fields: [taxId], references: [id])
 }
 enum ProductType {
   SINGLE
@@ -87,9 +89,9 @@
 model Order {
   id String @default(uuid()) @id
   cart Json
-  
+
   total Int
   stripePaymentIntentId String? @unique
   // @todo add address
@@ -107,4 +109,13 @@
   CANCELLED
   REFUNDED
   FAILED
 }
+
+model Tax {
+  id Int @default(autoincrement()) @id
+  name String @unique
+  taxRate Int
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now()) @updatedAt
+  products Product[] @relation("ProductTax")
+}
```


