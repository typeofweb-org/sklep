# Migration `20200915140959-add_cart`

This migration has been generated by Michal Miszczyszyn at 9/15/2020, 4:09:59 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Cart" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."CartToProduct" (
"cartId" text   NOT NULL ,
"productId" integer   NOT NULL ,
"quantity" integer   NOT NULL DEFAULT 1,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("cartId","productId")
)

ALTER TABLE "public"."CartToProduct" ADD FOREIGN KEY ("cartId")REFERENCES "public"."Cart"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CartToProduct" ADD FOREIGN KEY ("productId")REFERENCES "public"."Product"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200903152838-add-product..20200915140959-add_cart
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
   id Int @default(autoincrement()) @id
@@ -57,4 +57,29 @@
 enum ProductType {
   SINGLE
   BUNDLE // @todo
 }
+
+
+model Cart {
+  id String @default(cuid()) @id
+
+  cartProducts CartToProduct[]
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now()) @updatedAt
+}
+
+model CartToProduct {
+  @@id([cartId, productId])
+
+  cart Cart @relation(fields: [cartId], references: [id])
+  cartId String
+
+  product Product @relation(fields: [productId], references: [id])
+  productId Int
+
+  quantity Int @default(1)
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now()) @updatedAt
+}
```


