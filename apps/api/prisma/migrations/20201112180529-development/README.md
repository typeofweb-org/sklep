# Migration `20201112180529-development`

This migration has been generated by Bart≈Çomiej at 11/12/2020, 7:05:29 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Product" ADD COLUMN "coverImageId" integer   

CREATE TABLE "public"."Image" (
"id" SERIAL,
"path" text   NOT NULL ,
"alt" text   NOT NULL ,
"description" text   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"productId" integer   ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Product.coverImageId_unique" ON "public"."Product"("coverImageId")

ALTER TABLE "public"."Image" ADD FOREIGN KEY("productId")REFERENCES "public"."Product"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Product" ADD FOREIGN KEY("coverImageId")REFERENCES "public"."Image"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201101150422-sklep..20201112180529-development
--- datamodel.dml
+++ datamodel.dml
@@ -4,9 +4,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
   id Int @default(autoincrement()) @id
@@ -50,8 +50,12 @@
   userId Int
   addedBy User @relation(fields: [userId], references: [id])
+  images Image[] @relation("ProductImage")
+  coverImageId Int? @unique
+  coverImage Image? @relation(name: "CoverImage", fields: [coverImageId], references: [id])
+
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now()) @updatedAt
 }
@@ -107,4 +111,16 @@
   CANCELLED
   REFUNDED
   FAILED
 }
+
+model Image {
+  id           Int      @default(autoincrement()) @id
+  path         String 
+  alt          String
+  description  String?
+  createdAt    DateTime @default(now())
+  updatedAt    DateTime @default(now()) @updatedAt
+
+  productId    Int?
+  product      Product? @relation(name: "ProductImage", fields: [productId], references: [id])
+}
```


